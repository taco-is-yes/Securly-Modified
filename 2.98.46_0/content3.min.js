var sepPort=chrome.runtime.connect({name:"search_engine_parser"});let shContent=[];function sepOnWindowLoad(){let e=document.querySelector("title");if(e){if(-1!=document.location.hostname.indexOf("youtube")){var t=document.title.toString();new MutationObserver(function(e){e.some(function(e){var n=e.target.textContent.toString();(n=(n=n.replace(/^\([0-9]{0,}\)\s/,"")).replace(/ +/g," "))!=t&&-1!=document.URL.indexOf("results?search_query")&&(searchFlaggedData(n),t=n)})}).observe(e,{subtree:!0,characterData:!0,childList:!0})}sepCheckTitle(e)}else setTimeout(bingIssueFix,2e3)}function bingIssueFix(){if(-1!=document.location.hostname.indexOf("bing")){let e=document.querySelector("input[type=search]");if(e&&""!=e.value){return void searchFlaggedData(e.value+" - bing")}}}function sepCheckTitle(e){if(e&&(!e.text||""==e.text))return;let t=e.text;if(-1!=document.location.hostname.indexOf("youtube")){let e=/^\([0-9]{0,}\)\s/;t=(t=t.replace(e,"")).replace(/ +/g," ")}else-1!=document.location.hostname.indexOf("bing")&&(t=t.toLowerCase().replace(" - search"," - bing"));searchFlaggedData(t)}function searchFlaggedData(e){let t=!1;for(let n=0;n<shContent.length;n++){if(-1!=e.toLowerCase().indexOf("google")){let o=document.querySelector("div#taw");if(o&&(indexStr=o.innerHTML.toLowerCase().indexOf(shContent[n].toLowerCase()),-1!=indexStr)){let a=Array.from(o.getElementsByTagName("a")),r=a.length>0?a[0].href:"";t||sendSHData(e.toLowerCase().replace("- google search","").trim(),r,shContent[n],sepCleanDomainName(document.domain)),t=!0}}else if(-1!=e.toLowerCase().indexOf("bing")){let o=document.querySelector("li.b_ans.b_top");if(o&&(indexStr=o.innerHTML.toLowerCase().indexOf(shContent[n].toLowerCase()),-1!=indexStr)){let a=Array.from(o.getElementsByTagName("a")),r=a.length>0?a[0].href:"";t||sendSHData(e.toLowerCase().replace("- bing","").trim(),r,shContent[n],sepCleanDomainName(document.domain)),t=!0}}else if(-1!=e.toLowerCase().indexOf("yahoo search")){let o=document.querySelector("div#results div#main li.first");if(o&&(indexStr=o.innerHTML.toLowerCase().indexOf(shContent[n].toLowerCase()),-1!=indexStr)){let a=Array.from(o.getElementsByTagName("a")),r=a.length>0?a[0].href:"";t||sendSHData(e.toLowerCase().replace("- yahoo search results","").trim(),r,shContent[n],sepCleanDomainName(document.domain)),t=!0}}else if(-1!=e.toLowerCase().indexOf("- youtube")){let o=document.querySelector("ytd-emergency-onebox-renderer");if(o&&(indexStr=o.innerHTML.toLowerCase().indexOf(shContent[n].toLowerCase()),-1!=indexStr)){let a=Array.from(o.getElementsByTagName("a")),r=a.length>0?a[0].href:"";t||sendSHData(e.toLowerCase().replace("- youtube","").trim(),r,shContent[n],sepCleanDomainName(document.domain)),t=!0}}if(t)break}}function sepSendData(e){sepPort.postMessage({action:"fetchResult"})}function sendSHData(e,t,n,o){sepPort.postMessage({action:"sendSHResult",msg:e,url:t,matchedTerm:n,domain:o})}function sepCleanDomainName(e){return e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}function sepCallWindowLoadWithTimeOut(){sepSendData(),setTimeout(sepOnWindowLoad,2e3)}sepPort.onMessage.addListener(function(e){shContent=e}),window.addEventListener?window.addEventListener("load",sepCallWindowLoadWithTimeOut,!1):window.attachEvent&&window.attachEvent("onload",sepCallWindowLoadWithTimeOut);